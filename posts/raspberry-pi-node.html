<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>Khurram Aziz - Staging Node Application on Raspberry Pi</title>

  <link rel="canonical" href='/posts/raspberry-pi-node'>

      <link type="application/rss+xml" rel="alternate" title="Khurram Aziz" href="/feed.rss" />
      <link type="application/atom+xml" rel="alternate" title="Khurram Aziz" href="/feed.atom" />

  <meta name="application-name" content='Khurram Aziz' />
  <meta name="msapplication-tooltip" content='Khurram Aziz' />
  <meta name="msapplication-starturl" content='/' />

  <meta property="og:title" content='Khurram Aziz - Staging Node Application on Raspberry Pi' />
  <meta property="og:type" content="website" />
  <meta property="og:url" content='/posts/raspberry-pi-node' />

  <link rel="icon" href='/favicon.ico'>

  <!-- Custom fonts for this template -->
  <link href='/vendor/fontawesome-free/css/all.min.css' rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" data-no-mirror>
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" data-no-mirror>

  <!-- Styles for this template (also includes Bootstrap) -->
  <link href='/scss/clean-blog.css' rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js" data-no-mirror></script>
  <script src="https://cdn.jsdelivr.net/npm/quicklink@2.3.0/dist/quicklink.umd.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism.css" rel="stylesheet">

  


  

</head>

<body>

  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
  <div class="container">
    <a class="navbar-brand" href='/'>Khurram Aziz</a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
      Menu
      <i class="fas fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav ms-auto">
          <li class="nav-item">
    <a class="nav-link" href="/pages/about">About</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/pages/series">Series</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/posts">Posts</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tags">Tags</a>
  </li>

      </ul>
    </div>
  </div>
</nav>


  <!-- Page Header -->
  
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-8XSZL03B8G"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-8XSZL03B8G');
  </script>

<header class="masthead no-image">
  <div class="container position-relative">
    <div class="row">
      <div class="col-md-12">
        <div class='post-heading'>
          <h1>
            Staging Node Application on Raspberry Pi
          </h1>
            <div class="meta">Published on Thursday, May 19, 2016</div>
              <div class="mt-3">
                  <a href="/tags/linux" class="badge text-bg-light"> Linux</a>
                  <a href="/tags/node" class="badge text-bg-light"> Node</a>
                  <a href="/tags/raspberry-pi" class="badge text-bg-light"> Raspberry Pi</a>
                  <a href="/tags/system-administration" class="badge text-bg-light"> System Administration</a>
              </div>
        </div>
      </div>
    </div>
  </div>
</header>


  <!-- Main Content -->
  <div class="container">
    <div class="row">
      <div id="content" class="col-md-12">
        <h2>Staging Node Application</h2>  <ul>  <li>Part 1: <a title="Staging Node Application" href="http://weblogs.com.pk/khurram/archive/2016/05/18/staging-node-application.aspx">Staging Node Application</a></li>  <li>Part 2: <a title="Staging Node Application on Raspberry Pi" href="/posts/raspberry-pi-docker-node.html">Staging Node Application on Raspberry Pi</a></li>  <li>Part 3: <a title="Staging Node Application on Windows" href="http://weblogs.com.pk/khurram/archive/2016/06/03/staging-node-application-on-windows.aspx">Staging Node Application on Windows</a></li>  <li>Part 4: <a title="Running Node Application in Docker Container on Raspberry Pi" href="/posts/raspberry-pi-docker-node.html">Running Node Application in Docker Container on Raspberry Pi</a>  </li></ul>    <p>To make things interesting; lets test our Node application on <a href="https://www.raspberrypi.org" target="_blank">Raspberry Pi</a> running <a href="https://www.raspbian.org" target="_blank">Raspbian</a>. Raspbian; just like Ubuntu; is based on Debian, so the learnings we did in first part can be applied. Raspberry Pi is interesting due to its low cost, credit card sized and Raspbian OS, it can provide PC like computing in the field or workplace needing very little power and this enables lots of new interesting possibilities. PS Raspbian OS is one option; we can try/use other OSes on this little thing!</p>      <p><img width="640" height="360" title="WP_20160517_11_09_37_Raw_LI" style="border-left-width:0px;border-right-width:0px;background-image:none;border-bottom-width:0px;padding-top:0px;padding-left:0px;margin:10px 10px 0px 0px;display:inline;padding-right:0px;border-top-width:0px;" alt="WP_20160517_11_09_37_Raw_LI" src="/images/91e3af21d5bf_FEC7/WP_20160517_11_09_37_Raw_LI.jpg" border="0"></p>      <ul>     <li>Raspberry Pi Model B+ </li>        <li>You can use any USB phone chargers or battery packs that are conveniently available to power it </li>   </ul>      <p>Raspberry Pi uses SD Card for its storage; and knowing few tricks can help us. Always go for the Class 10 card to get best I/O performance. Raspbian makes two partition; one is readable in Windows but other is not as its EXT4 partition. We can use Ext2Explore or Linux Reader utilities to read the content of the Linux partition; Ext2Explore is better; as its just single EXE not needing any installation etc. Unfortunately these both provide read only access; and can be used for scenarios where you want to copy/backup contents of some files from the SD card (say /etc/someconfig) Paragon ExtFS for Windows has necessary drivers and interface through which you can mount these EXT* partitions in Windows; similar to USB drives and can read/write files. This can be useful when you need to write some configuration (say defining static IP)</p>      <p>Raspberry Pi uses HDMI / Video out; and not all the time you can have a luxury to mount a display; if we install Raspbian in a headless / GUI-less mode; the default configurations are good enough that we don't need any display and can burn the “image” to the SD Card and on boot it installs it automatically and gets the IP from the DHCP. If we connect it via ethernet to a typical Wi-Fi Router (with ethernet ports) we can get the IP from the router interface and in there can even give static IP to the Raspberry; similar to how we did in the first part. Once we know the IP; we can SSH; its default login/password is pi/raspberry (we should of course change it straight away using <font face="Courier New">$ passwd</font>)</p>      <p><img width="416" height="215" title="image" style="border-left-width:0px;border-right-width:0px;background-image:none;border-bottom-width:0px;padding-top:0px;padding-left:0px;margin:10px 10px 0px 0px;display:inline;padding-right:0px;border-top-width:0px;" alt="image" src="/images/91e3af21d5bf_FEC7/image.png" border="0"></p>      <ul>     <li><a title="https://www.raspberrypi.org/help/what-is-a-raspberry-pi/" href="https://www.raspberrypi.org/help/what-is-a-raspberry-pi">What is a Raspberry Pi?</a> </li>        <li><a href="https://www.raspberrypi.org/documentation/installation/installing-images/windows.md" target="_blank">Installing Operating System Images using Windows</a> </li>   </ul>      <p>By default time zone is set to UTC; to set the time zone use<font face="Courier New"> $ sudo dpkg-reconfigure tzdata</font>; Raspbian Lite doesn't come with GIT tools; so we need to install them as well using:</p>      <p><font face="Courier New">$ sudo apt-get update      <br>$ sudo apt-get install git</font></p>      <p>All the remaining steps are same as of Part 1 <a title="Staging Node Application" href="http://weblogs.com.pk/khurram/archive/2016/05/18/staging-node-application.aspx">Staging Node Application</a></p>    <h2>Summary of Part 1 <a title="Staging Node Application" href="http://weblogs.com.pk/khurram/archive/2016/05/18/staging-node-application.aspx">Staging Node Application</a></h2>    <ul>     <li>Create ~/hello and ~/hello.git</li>        <li>$ git init –bare in ~/hello.git</li>        <li>$ nano ~/hello.git/hooks/post-receive and punch in</li>        <p>#!/bin/sh      <br>GIT_WORK_TREE=/home/pi/hello git checkout -f</p>        <li>If node is not installed; $ sudo apt-get install –y nodejs and $sudo apt-get install –y npm</li>        <li>Install PM2; $ sudo npm install pm2 –g; make node link for nodejs as PM2 expects node; $ ln –s /usr/bin/nodejs /usr/bin/node</li>        <li>Make a simple hello world js at client and push it to the server’s ~/hello.git; and it will automatically gets available at ~/hello due to git hook</li>        <li>Start it with PM2 $ pm2 start hello.js</li>        <li>Add pm2 restart hello into git hooks/post-receive so it restarts the app</li>   </ul>      <p>At the development machine; we can add multiple “Remote”s to our source code folder and to make our code run on server with any ip; we can give 0.0.0.0 as ip or completely omit it and just give port; doing so our Node application will run on all ips of the machine</p>      <p><img width="1153" height="487" title="image" style="border-left-width:0px;border-right-width:0px;background-image:none;border-bottom-width:0px;padding-top:0px;padding-left:0px;margin:10px 10px 0px 0px;display:inline;padding-right:0px;border-top-width:0px;" alt="image" src="/images/91e3af21d5bf_FEC7/image_3.png" border="0"></p>      <p>Changing the code and committing; TortoiseGit will give us option to push and from there we can select where to push the changes!</p>      <p><img width="493" height="498" title="image" style="border-left-width:0px;border-right-width:0px;background-image:none;border-bottom-width:0px;padding-top:0px;padding-left:0px;margin:10px 10px 0px 0px;display:inline;padding-right:0px;border-top-width:0px;" alt="image" src="/images/91e3af21d5bf_FEC7/image_4.png" border="0"></p>      <ul>     <li><a href="https://tortoisegit.org/">https://tortoisegit.org/</a> </li>   </ul>      <p>Selecting all will push our changes to both the servers and it will run accordingly. In first part; we used PM2 to “deamonize” our Node application; on reboot; our app will not launch; we need to create a “startup script” for PM2; for this we need to first save the pm2 running configurations and then use pm2 startup option. systemd is available on both latest versions of Raspbian and Ubuntu and we can use pm2 startup systemd</p>      <p><font face="Courier New">pi&#64;raspberrypi:~/hello $ pm2 save      <br>[PM2] Saving current process list...       <br>[PM2] Successfully saved in /home/pi/.pm2/dump.pm2       <br>pi&#64;raspberrypi:~/hello $ sudo pm2 startup systemd -u pi</font></p>      <p><font face="Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -------------</font></p>      <p><font face="Courier New">&nbsp;&nbsp; Looking for a complete monitoring and management tool for PM2?      <br>&nbsp;&nbsp;&nbsp; _&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _       <br>&nbsp;&nbsp; | | _____ _&nbsp;&nbsp; _ _ __ ___&nbsp;&nbsp; ___| |_ _ __(_) ___ ___&nbsp; (_) ___       <br>&nbsp;&nbsp; | |/ / _ \ | | | '_ ` _ \ / _ \ __| '__| |/ __/ __| | |/ _ \       <br>&nbsp;&nbsp; |&nbsp;&nbsp; &lt;&nbsp; __/ |_| | | | | | |&nbsp; __/ |_| |&nbsp; | | (__\__ \_| | (_) |       <br>&nbsp;&nbsp; |_|\_\___|\__, |_| |_| |_|\___|\__|_|&nbsp; |_|\___|___(_)_|\___/       <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |___/</font></p>      <p><font face="Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Features</font></p>      <p><font face="Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - Real Time Dashboard      <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - CPU/Memory monitoring       <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - HTTP monitoring       <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - Event notification       <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - Custom value monitoring       <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - Real Time log display</font></p>      <p><font face="Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Checkout</font></p>      <p><font face="Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </font><font face="Courier New">https://keymetrics.io/</font></p>      <p><font face="Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -------------</font></p>      <p><font face="Courier New">[PM2] Spawning PM2 daemon      <br>[PM2] PM2 Successfully daemonized       <br>[PM2] Generating system init script in /etc/systemd/system/pm2.service       <br>[PM2] Making script booting at startup...       <br>[PM2] -systemd- Using the command:       <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; su pi -c "pm2 dump &amp;&amp; pm2 kill" &amp;&amp; su root -c "systemctl daemon-reload &amp;&amp; systemctl enable pm2 &amp;&amp; systemctl start pm2"       <br>Created symlink from /etc/systemd/system/multi-user.target.wants/pm2.service to /etc/systemd/system/pm2.service.       <br>[PM2] Saving current process list...       <br>[PM2] Successfully saved in /home/pi/.pm2/dump.pm2       <br>[PM2] Stopping PM2...       <br>[PM2] Applying action deleteProcessId on app [all](ids: 0)       <br>[PM2] [hello](0) ✓       <br>[PM2] All processes have been stopped and deleted       <br>[PM2] PM2 stopped       <br>[PM2] Done.</font></p>      <p>Once done; we can issue <font face="Courier New">$ sudo shutdown –r</font> at both machines to reboot them and once they are back we can check if pm2 has started our app by issuing <font face="Courier New">$ pm2 list</font> and if they are; try them out from the client / development machine</p>      <p><img width="405" height="262" title="image" style="border-left-width:0px;border-right-width:0px;background-image:none;border-bottom-width:0px;padding-top:0px;padding-left:0px;margin:10px 10px 0px 0px;display:inline;padding-right:0px;border-top-width:0px;" alt="image" src="/images/91e3af21d5bf_FEC7/image_5.png" border="0"></p>      <ul>     <li><a href="http://pm2.keymetrics.io/docs/usage/pm2-doc-single-page" target="_blank">PM2 One Page Documentation</a> </li>        <li><a href="https://en.wikipedia.org/wiki/Systemd" target="_blank">Wikipedia :: systemd</a> </li>        <li><a href="https://wiki.debian.org/systemd" target="_blank">debian wiki :: systemd</a> </li>   </ul>      <p>&nbsp;</p>      <p>So far we have been exposing Node http server as-is; but in production; we should have a proper web server serving the requests and node should remain internal; lets install NGINX; a popular web and reverse proxy server; and once installed; edit the /etc/nginx/sites-available/default to setup our application in nginx</p>      <p><font face="Courier New">$ sudo apt-get install nginx      <br>$ sudo cp /etc/nginx/sites-available/default /etc/nginx/sites-available/default.original       <br>$ sudo nano /etc/nginx/sites-available/default</font></p>      <p>Delete everything and punch in the following to reverse proxy our http://localhost:3000 application at http://ip/node</p>      <p><font face="Courier New">server {      <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; listen 80 default_server;       <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; listen [::]:80 default_server;       <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; index index.html index.htm;       <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; server_name _;       <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; location /node {       <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; proxy_pass http://localhost:3000;       <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; proxy_http_version 1.1;       <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; proxy_set_header Upgrade $http_upgrade;       <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; proxy_set_header Connection 'upgrade';       <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; proxy_set_header Host $host;       <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; proxy_cache_bypass $http_upgrade;       <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }       <br>}</font></p>      <p>Next restart the nginx service</p>      <p><font face="Courier New">$ sudo /etc/init.d/nginx restart</font></p>      <p>We can install and configure nginx same way on Raspbian as well; once its installed we will have our application at respective <a href="http://ip/node">http://ip/node</a>     <br><img width="480" height="282" title="image" style="border-left-width:0px;border-right-width:0px;background-image:none;border-bottom-width:0px;padding-top:0px;padding-left:0px;margin:10px 10px 0px 0px;display:inline;padding-right:0px;border-top-width:0px;" alt="image" src="/images/91e3af21d5bf_FEC7/image_6.png" border="0"></p>      <ul>     <li><a title="http://nginx.org" href="http://nginx.org/">http://nginx.org/</a> </li>        <li><a title="http://nginx.org/en/docs/beginners_guide.html" href="http://nginx.org/en/docs/beginners_guide.html">NGINX Beginners Guide</a> </li>   </ul>      <p>We can now update the node code to listen to just localhost (127.0.0.1); update the code; commit and push to both and applications will restart itself with our git hooks in place!</p>


        

      </div>
    </div>
  </div>

  <hr>

  <!-- Footer -->
  <footer>
  <div class="container">
    <div class="row">
      <div class="col-md-12 text-center">
        <p class="copyright">Copyright &#xA9; 2024</p>

        <ul class="list-inline text-center small">
            <li class="list-inline-item">
              <a href="/feed.rss"><i class="fa fa-rss"></i> RSS Feed</a>
            </li>
            <li class="list-inline-item">
              <a href="/feed.atom"><i class="fa fa-rss"></i> Atom Feed</a>
            </li>
        </ul>
        <br />
        <div class="font-weight-bold small"><a href="https://statiq.dev">Generated by Statiq</a></div>
      </div>
    </div>
  </div>
</footer>


  <!-- Scripts -->
  <script src='/vendor/bootstrap/js/bootstrap.bundle.min.js'></script>
  <script src='/vendor/startbootstrap-clean-blog/js/scripts.js'></script>
  <script src='/js/clean-blog.js'></script>
  

  

</body>

</html>
