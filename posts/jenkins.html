<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>Khurram Aziz - Jenkins</title>

  <link rel="canonical" href='/posts/jenkins'>

      <link type="application/rss+xml" rel="alternate" title="Khurram Aziz" href="/feed.rss" />
      <link type="application/atom+xml" rel="alternate" title="Khurram Aziz" href="/feed.atom" />

  <meta name="application-name" content='Khurram Aziz' />
  <meta name="msapplication-tooltip" content='Khurram Aziz' />
  <meta name="msapplication-starturl" content='/' />

  <meta property="og:title" content='Khurram Aziz - Jenkins' />
  <meta property="og:type" content="website" />
  <meta property="og:url" content='/posts/jenkins' />

  <link rel="icon" href='/favicon.ico'>

  <!-- Custom fonts for this template -->
  <link href='/vendor/fontawesome-free/css/all.min.css' rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" data-no-mirror>
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" data-no-mirror>

  <!-- Styles for this template (also includes Bootstrap) -->
  <link href='/scss/clean-blog.css' rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js" data-no-mirror></script>
  <script src="https://cdn.jsdelivr.net/npm/quicklink@2.3.0/dist/quicklink.umd.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism.css" rel="stylesheet">

  


  

</head>

<body>

  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
  <div class="container">
    <a class="navbar-brand" href='/'>Khurram Aziz</a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
      Menu
      <i class="fas fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav ms-auto">
          <li class="nav-item">
    <a class="nav-link" href="/pages/about">About</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/pages/series">Series</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/posts">Posts</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tags">Tags</a>
  </li>

      </ul>
    </div>
  </div>
</nav>


  <!-- Page Header -->
  
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-8XSZL03B8G"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-8XSZL03B8G');
  </script>

<header class="masthead no-image">
  <div class="container position-relative">
    <div class="row">
      <div class="col-md-12">
        <div class='post-heading'>
          <h1>
            Jenkins
          </h1>
            <div class="meta">Published on Thursday, March 23, 2017</div>
              <div class="mt-3">
                  <a href="/tags/net" class="badge text-bg-light"> .NET</a>
                  <a href="/tags/devops" class="badge text-bg-light"> DevOps</a>
                  <a href="/tags/docker" class="badge text-bg-light"> Docker</a>
                  <a href="/tags/linux" class="badge text-bg-light"> Linux</a>
              </div>
        </div>
      </div>
    </div>
  </div>
</header>


  <!-- Main Content -->
  <div class="container">
    <div class="row">
      <div id="content" class="col-md-12">
        <p><img title="jenkins-logo" style="border-left-width:0px;border-right-width:0px;background-image:none;border-bottom-width:0px;float:right;padding-top:0px;padding-left:0px;margin:10px 10px 0px 0px;display:inline;padding-right:0px;border-top-width:0px;" alt="jenkins-logo" src="/images/Jenkins_11AFB/jenkins-logo.png" border="0" height="312" align="right" width="226">    <table cellspacing="0" cellpadding="0">        <tr>            <td style="width:300px;vertical-align:top;">                <p><b>Docker Swarm Series</b></p>                <ul>                    <li><a target="_blank" href="docker-swarm.html">Docker Swarm</a></li>                    <li><a target="_blank" href="docker-registry.html">Docker Registry</a></li>                    <li>This Post</li>    <li><a target="_blank" href="swarm-and-prometheus.html">Swarm and Prometheus</a></li>  <li><a target="_blank" href="swarm-and-prometheus-ii.html">Swarm and Prometheus II</a></li>                </ul>          </td>            <td style="width:300px;vertical-align:top;">                <p><b>Dotnet Core Series</b></p>                <ul>                    <li><a target="_blank" href="dotnet-core.html">Dotnet Core</a></li>                    <li><a target="_blank" href="redis-clients-asp-net-core.html">Redis Clients -- ASP.NET Core</a></li>                    <li><a target="_blank" href="docker-registry.html">Docker Registry</a></li>                    <li>This Post</li>                    <li><a target="_blank" href="dotnetcore-postgresql.html">Dotnet Core -- PostgreSQL</a></li>              </ul>          </td>      </tr>  </table>      <p><a target="_blank" href="https://jenkins.io/">Jenkins</a> is an open source “automation server” developed in Java. Its more than a typical build system / tool, its additional features and plugins; can help to automate the non-human part of the software development process. Its a server based system that needs a servlet container such as Tomcat. There are number of plugins available for integration with different version control systems and databases, setting up automated tests using the framework of your choice including MSTest and NUnit and doing lot more during the build than compiling the code. If Java and Servlet Containers are not your &quot;thing&quot;; running Jenkins in the Docker provides enough black box around these that getting started with it cant be more simpler. There is an official image on the Docker Hub and we just need to map its two exposed port; one for its web interface and the other that its additional agents uses to connect to the server. All that needs to run its instance is <b>docker run –p 8080:8080 –p 50000:50000 jenkins</b>; we can optionally map the container’s /var/jenkins_home to some local folder as well. To learn more options that can be set using the environment variables like JVM options; visit <a href="https://hub.docker.com/_/jenkins">https://hub.docker.com/_/jenkins</a></p>      <p>We can use Jenkins to build Dotnet Core projects; all we need is to install the Dotnet Core SDK on the system running the Jenkins. For the Container; we can expand the official image and write a Dockerfile to install the required things; but first we need to check which Linux jenkins image is based on and for that; do this</p>      <p><img title="jenkins-image-linux" style="border-left-width:0px;border-right-width:0px;background-image:none;border-bottom-width:0px;padding-top:0px;padding-left:0px;margin:10px 10px 0px 0px;display:inline;padding-right:0px;border-top-width:0px;" alt="jenkins-image-linux" src="/images/Jenkins_11AFB/jenkins-image-linux.png" border="0" height="263" width="720"></p>      <p>Knowing that its Debian 8 and its running the things under jenkins user; lets make a Dockerfile for our custom Jenkins docker image</p>   <script src="https://gist.github.com/khurram-aziz/e12c22199b097f06e62cf5ffdcf29e10.js"></script>    <ul>     <li>Note that we used information from <a target="_blank" href="https://www.microsoft.com/net/core#linuxdebian">https://www.microsoft.com/net/core#linuxdebian</a> on how to install the latest Dotnet Core SDK on Debian </li>        <li>Note that we added git plugin as per guideline at <a title="https://github.com/jenkinsci/docker" target="_blank" href="https://github.com/jenkinsci/docker">https://github.com/jenkinsci/docker</a> where this official image is maintained; they have provided the install-plugins.sh script; and we can install the plugins while making the image; and we will not have to reinstall these plugins when running the Jenkins </li>   </ul>      <p>If we build this Dockerfile and tag the image as dotjenkins; we can run it using docker run –rm –p 8080:8080 –p 50000:50000 dotjenkins; running on a console is required so we can get the initial admin password from the info that gets emitted; its required on the first run setup wizard when we will open the http://localhost:8080</p>      <ul>     <li>Visit <a target="_blank" href="dockerfile.html">Dockerfile</a>; if you need the heads up on how to build Docker image from such file</li>    <li>During the setup; you can choose Custom Plugins; and then select none; and we will have the minimalist Jenkins ready to build the Dotnet Core project from Git Repository </li>   </ul>      <p>You can setup a test project; giving <a href="https://github.com/khurram-aziz/HelloDocker">https://github.com/khurram-aziz/HelloDocker</a> as Git path that has a Dotnet Core MVC application</p>      <p><img title="jenkins-git" style="border-left-width:0px;border-right-width:0px;background-image:none;border-bottom-width:0px;padding-top:0px;padding-left:0px;margin:10px 10px 0px 0px;display:inline;padding-right:0px;border-top-width:0px;" alt="jenkins-git" src="/images/Jenkins_11AFB/jenkins-git.png" border="0" height="440" width="672"></p>      <p> </p>      <p> </p>      <p><img title="jenkins-build-shell" style="border-left-width:0px;border-right-width:0px;background-image:none;border-bottom-width:0px;float:right;padding-top:0px;padding-left:0px;margin:10px 10px 0px 0px;display:inline;padding-right:0px;border-top-width:0px;" alt="jenkins-build-shell" src="/images/Jenkins_11AFB/jenkins-build-shell.png" border="0" height="258" align="right" width="329"><img title="jenkins-build-shell-step" style="border-left-width:0px;border-right-width:0px;background-image:none;border-bottom-width:0px;float:right;padding-top:0px;padding-left:0px;margin:10px 10px 0px 0px;display:inline;padding-right:0px;border-top-width:0px;" alt="jenkins-build-shell-step" src="/images/Jenkins_11AFB/jenkins-build-shell-step.png" border="0" height="219" align="right" width="464">And then can use Execute shell Build step type and enter the familiar dotnet restore and dotnet build commands to build the Dotnet Core application with the Jenkins</p>      <p>Once the test job is setup; we can build it; and it will download the code from Git and build it as per the steps we have defined. We can see the Console output from the web interface as well!</p>      <p><img title="jenkins-build-consoleoutput" style="border-left-width:0px;border-right-width:0px;background-image:none;border-bottom-width:0px;padding-top:0px;padding-left:0px;margin:10px 10px 0px 0px;display:inline;padding-right:0px;border-top-width:0px;" alt="jenkins-build-consoleoutput" src="/images/Jenkins_11AFB/jenkins-build-consoleoutput.png" border="0" height="732" width="984"></p>      <p> </p>      <p>If you are following the Dotnet Core Series; in the last post; <a title="Docker Registry" target="_blank" href="docker-registry.html">Docker Registry</a>; we also needed to build the mvcapp Docker Container after publishing the Mvc application. In that post; the developer had to have the <a target="_blank" href="https://docs.docker.com/docker-for-windows/">Docker for Windows</a> installed, as to build the Docker image; we need the Docker Daemon; and we also needed the access of the Docker Registry so we can push the Mvc application as the Docker Container from where the Swarm Nodes will pick it when System Administrator will deploy the “Stack” on the <a target="_blank" href="docker-swarm.html">Docker Swarm</a>. We can solve this using the Jenkins; that it can not only automate this manual work; but also we will neither need Docker for Windows at the developer machine nor will need to give access of Docker Registry to the developer.</p>      <p>To build Docker Container Image; from Jenkins running in Docker Container; we first need to technically assess how it can be done.</p>      <ul>     <li>We need to study the Dockerfile of Jenkins at its <a target="_blank" href="https://github.com/jenkinsci/docker">GitHub Repo</a>, as its creating jenkins user with uid 1000 and running the things under this user. </li>        <li>We will need the Docker CLI tools in the container </li>        <li>We will need the access of Docker Daemon in the container so that it can build the Docker Images using the Docker daemon </li>   </ul>      <p>Lets make a separate Dockerfile first to technically assess it without the Jenkins overhead.</p>   <script src="https://gist.github.com/khurram-aziz/975e57a6afebc1436e857594213660f6.js"></script>    <p>If we build and tag the above Dockerfile as dockcli; we can run it as <b>docker run -v /var/run/docker.sock:/var/run/docker.sock -it dockcli</b></p>      <ul>     <li>Note that we exposed /var/run/docker.sock file as VOLUME in the Dockerfile; so that we can map it when running the container passing the docker.sock file of the Docker Daemon where its “launching” this way we dont need to run the Docker Daemon in the Container and we can “reuse” the Docker Daemon where our image will run; there exists “Docker in Docker” image using which we can run the Docker Daemon inside the Container; but we dont need it here </li>        <li>We created a jenkins user similar to how its made and configured in the official Jenkins image </li>        <li>We need to add jenkins into sudoers (and for that we also need to install sudo first) so we can access docker.sock using sudo; else it will not have enough permissions </li>   </ul>      <p>With these arrangements we can access the Docker Daemon from with in the Docker Container!</p>      <p><img title="jenkins-sudo" style="border-top:0px;border-right:0px;background-image:none;border-bottom:0px;padding-top:0px;padding-left:0px;border-left:0px;margin:10px 10px 0px 0px;display:inline;padding-right:0px;" alt="jenkins-sudo" src="/images/Jenkins_11AFB/jenkins-sudo.png" border="0" height="352" width="1032"></p>      <p>Now lets add back this work to our dotjenkins Dockerfile; so we can create the Docker Image after the Dotnet Core build in the Jenkins. Here’s the final Dockerfile</p>      <script src="https://gist.github.com/khurram-aziz/6371de03771fb9b9b7478472193a5c07.js"></script>    <p>Lets run our customized Jenkins image using <b>docker run --name jenk --rm -p 8080:8080 -v /var/run/docker.sock:/var/run/docker.sock dotjenkins</b></p>      <p>We can now add Docker Image Creation step in our project build steps</p>      <p><img title="jenkins-build-dockerstep" style="border-top:0px;border-right:0px;background-image:none;border-bottom:0px;padding-top:0px;padding-left:0px;border-left:0px;margin:10px 10px 0px 0px;display:inline;padding-right:0px;" alt="jenkins-build-dockerstep" src="/images/Jenkins_11AFB/jenkins-build-dockerstep.png" border="0" height="223" width="508"></p>      <ul>     <li>Note the usage of Jenkins variable as the tag for the image we are creating</li>   </ul>      <p>If we do a Jenkins build; we will see the Docker step output in the Console Output and shortly afterwords we will have the required image in the Docker Daemon where Jenkins Container is running</p>      <p><img title="jenkins-build-dockeroutput" style="border-top:0px;border-right:0px;background-image:none;border-bottom:0px;padding-top:0px;padding-left:0px;border-left:0px;margin:10px 10px 0px 0px;display:inline;padding-right:0px;" alt="jenkins-build-dockeroutput" src="/images/Jenkins_11AFB/jenkins-build-dockeroutput.png" border="0" height="304" width="1150"></p>      <p>We can use <a target="_blank" href="docker-compose.html">docker-compose</a> to define all the related switches needed to run the docker image so it becomes a simple docker-compose up command. On the similar lines; we can now add additional step to push the generated Docker image to the Docker Registry!</p></p>


        

      </div>
    </div>
  </div>

  <hr>

  <!-- Footer -->
  <footer>
  <div class="container">
    <div class="row">
      <div class="col-md-12 text-center">
        <p class="copyright">Copyright &#xA9; 2024</p>

        <ul class="list-inline text-center small">
            <li class="list-inline-item">
              <a href="/feed.rss"><i class="fa fa-rss"></i> RSS Feed</a>
            </li>
            <li class="list-inline-item">
              <a href="/feed.atom"><i class="fa fa-rss"></i> Atom Feed</a>
            </li>
        </ul>
        <br />
        <div class="font-weight-bold small"><a href="https://statiq.dev">Generated by Statiq</a></div>
      </div>
    </div>
  </div>
</footer>


  <!-- Scripts -->
  <script src='/vendor/bootstrap/js/bootstrap.bundle.min.js'></script>
  <script src='/vendor/startbootstrap-clean-blog/js/scripts.js'></script>
  <script src='/js/clean-blog.js'></script>
  

  

</body>

</html>
